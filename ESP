local Rexy = {}

-- Default settings
Rexy.ESP = {
    Box = true,
    Name = true,
    Distance = true
}

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local Camera = game:GetService("Workspace").CurrentCamera

-- Helper function to draw a box around a character
local function drawBox(character)
    local head = character:FindFirstChild("Head")
    if not head then return end
    
    local pos, onScreen = Camera:WorldToScreenPoint(head.Position)
    if onScreen then
        local boxSize = Vector2.new(100, 100) -- Arbitrary size, scale accordingly
        local boxPos = Vector2.new(pos.X - boxSize.X / 2, pos.Y - boxSize.Y / 2)

        -- Drawing the box (you can replace this with your GUI draw function)
        local box = Instance.new("Frame")
        box.Size = UDim2.new(0, boxSize.X, 0, boxSize.Y)
        box.Position = UDim2.new(0, boxPos.X, 0, boxPos.Y)
        box.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        box.Parent = game:GetService("CoreGui")
    end
end

-- Helper function to display a name above the character
local function drawName(character)
    local head = character:FindFirstChild("Head")
    if not head then return end

    local pos, onScreen = Camera:WorldToScreenPoint(head.Position)
    if onScreen then
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Text = character.Name
        nameLabel.Position = UDim2.new(0, pos.X, 0, pos.Y)
        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        nameLabel.TextSize = 14
        nameLabel.BackgroundTransparency = 1
        nameLabel.Parent = game:GetService("CoreGui")
    end
end

-- Helper function to display distance from the player
local function drawDistance(character, player)
    local head = character:FindFirstChild("Head")
    if not head then return end

    local pos, onScreen = Camera:WorldToScreenPoint(head.Position)
    if onScreen then
        local distance = (character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).magnitude
        local distanceLabel = Instance.new("TextLabel")
        distanceLabel.Text = math.floor(distance) .. " studs"
        distanceLabel.Position = UDim2.new(0, pos.X, 0, pos.Y + 20)
        distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        distanceLabel.TextSize = 14
        distanceLabel.BackgroundTransparency = 1
        distanceLabel.Parent = game:GetService("CoreGui")
    end
end

-- Main loop
local function updateESP()
    local player = Players.LocalPlayer
    for _, targetPlayer in ipairs(Players:GetPlayers()) do
        if targetPlayer ~= player and targetPlayer.Character then
            if Rexy.ESP.Box then
                drawBox(targetPlayer.Character)
            end
            if Rexy.ESP.Name then
                drawName(targetPlayer.Character)
            end
            if Rexy.ESP.Distance then
                drawDistance(targetPlayer.Character, player)
            end
        end
    end
end

-- Continuous update of ESP
game:GetService("RunService").Heartbeat:Connect(updateESP)

-- Allow toggling of ESP settings
function Rexy.ToggleESP(component, state)
    if Rexy.ESP[component] ~= nil then
        Rexy.ESP[component] = state
    end
end

-- Return the Rexy library for use
return Rexy
