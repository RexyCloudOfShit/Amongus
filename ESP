-- Create the Rexy table
local Rexy = {}
Rexy.ESP = {
    Box = false,
    Name = false,
    Distance = false
}

-- Create a Drawings table to store ESP elements
local Drawings = {}
Drawings.Box = nil
Drawings.Name = nil
Drawings.Distance = nil

-- Function to initialize or update the ESP settings for a player
function Rexy.ESP.Update(player)
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
        return
    end

    local hrp = player.Character.HumanoidRootPart
    local screenPosition, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)
    local distance = (hrp.Position - workspace.CurrentCamera.CFrame.p).Magnitude

    -- Box ESP
    if Rexy.ESP.Box then
        if not Drawings.Box then
            Drawings.Box = Drawing.new("Square")
            Drawings.Box.Thickness = 2
            Drawings.Box.Color = Color3.fromRGB(255, 0, 0)
            Drawings.Box.Filled = false
        end
        Drawings.Box.Position = Vector2.new(screenPosition.X - 50, screenPosition.Y - 100)  -- Adjust as needed
        Drawings.Box.Size = Vector2.new(100, 200) -- Adjust size based on player model
        Drawings.Box.Visible = onScreen
    elseif Drawings.Box then
        Drawings.Box.Visible = false
    end

    -- Name ESP
    if Rexy.ESP.Name then
        if not Drawings.Name then
            Drawings.Name = Drawing.new("Text")
            Drawings.Name.Size = 14
            Drawings.Name.Color = Color3.fromRGB(255, 255, 255)
            Drawings.Name.Center = true
            Drawings.Name.Outline = true
        end
        Drawings.Name.Position = Vector2.new(screenPosition.X, screenPosition.Y - 120) -- Adjust as needed
        Drawings.Name.Text = player.Name
        Drawings.Name.Visible = onScreen
    elseif Drawings.Name then
        Drawings.Name.Visible = false
    end

    -- Distance ESP
    if Rexy.ESP.Distance then
        if not Drawings.Distance then
            Drawings.Distance = Drawing.new("Text")
            Drawings.Distance.Size = 14
            Drawings.Distance.Color = Color3.fromRGB(255, 255, 255)
            Drawings.Distance.Center = true
            Drawings.Distance.Outline = true
        end
        Drawings.Distance.Position = Vector2.new(screenPosition.X, screenPosition.Y - 140) -- Adjust as needed
        Drawings.Distance.Text = string.format("%.2f studs", distance)
        Drawings.Distance.Visible = onScreen
    elseif Drawings.Distance then
        Drawings.Distance.Visible = false
    end
end

-- Main loop to update ESP for all players in the game
game:GetService("RunService").RenderStepped:Connect(function()
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        Rexy.ESP.Update(player)
    end
end)

-- Return the Rexy table so it's accessible from outside
return Rexy
